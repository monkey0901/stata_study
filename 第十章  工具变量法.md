# 第十章  工具变量法

OLS成立条件：解释变量与扰动项不相关

解决内生性的方法：工具变量法

内生性的主要来源：遗漏变量偏差、联立方程偏差、测量误差偏差

## 10.1  联立方程偏差

## 10.2  测量误差偏差

如果被解释变量存在测量误差，后果并不严重，只要被解释变量的测量误差与解释变量不相关，则OLS依然一致。

## 10.3  工具变量法

解决内生性的方法：① 将内生变量分为两部分，即一部分与扰动项相关，而另一部分与扰动项不相关，用与扰动项不相关的那一部分得到一致估计；② 工具变量

- 工具变量需满足的条件：① 相关性，工具变量与内生解释变量相关；② 外生性，工具变量与扰动项不相关

![image-20200726095436785](https://i.loli.net/2020/07/26/vEDLebjAzKsUohN.png)

## 10.4  二阶段最小二乘法

- 步骤：① 第一阶段回归，用内生变量对工具变量回归；② 用被解释变量对第一阶段回归的拟合值进行回归。

- 在第二阶段回归中，拟合值p_t与扰动项ε_t不相关

- 2SLS的实质是把内生解释变量P_t分成两部分，即由工具变量z_t所造成的外生部分（p_t）以及与扰动项相关的其余部分残差; 然后，把被解释变量q_t对P_t中的外生部分进行回归，从而满足OLS对前定变量的要求而得到一致估计。

- 两种不同情况：① 存在多个工具变量

  ② 存在多个内生变量

- **阶条件**：进行2SLS估计的必要条件是工具变量个数不少于内生解释变量的个数，称为“ 阶条件" (order condition) 。
  根据阶条件是否满足可分为以下三种情况：
  (1) 不可识别(unidentified) : 工具变量个数小于内生解释变量个数；
  (2) 恰好识别(just or exactly identified) : 工具变量个数等于内生解释变量个数；
  (3) 过度识别(overidentified) : 工具变量个数大于内生解释变量个数。
  在恰好识别与过度识别的情况下，都可以使用2SLS; 但在不可识别的情况下，则无法使用2SLS。

```stata
ivregress 2sls y x1 x2 (x3 = z1 z2),robust first
```

其中，"y"为被解释变量，"x1 x2"为外生解释变量，"x3"为内生解释变量，而"z1 z2"为方程外的工具变量。选择项“ robust"表示使用异方差稳健的标准误（默认为普通标准误）；选择项“ first"表示显示第一阶段的回归结果。

- ① 在球形扰动项的情况下，2SLS是最有效率的工具变量法。

  ② 然而，在异方差的情况下，则存在更有效率的工具变量法，即“ 广义矩估计"( Gener alized Method of Moment,s GMM), 是数理统计中“ 矩估计"(Method of Moments GMM)的推广。

  ③ 直观上，GMM之于2SLS,正如GLS与OLS的关系。而且，在恰好识别的情况，GMM 就等价于2SLS。

## 10.5  弱工具变量

检验是否存在弱工具变量：在第一阶段回归中，检验所有方程外的工具变量的系数是否联合为零。如果此检验的F统计量大于10，则可拒绝存在弱工具变量的原假设。

```stata
#检验弱工具变量
estat firststage
```

遇到弱工具变量的解决方法：

1. 寻找更强的工具变量
2. 使用对弱工具变量不敏感的“有限信息最大似然估计”（LIML）在大样本下，LIML与2SLS渐近等价，但在弱工具变量的情况下LIML的小样本性质可能优于2SLS。

```stata
ivregress liml y x1 x2 (x3 = z1 z2)
```

## 10.6  对工具变量外生性的过度识别检验

对工具变量的外生性进行检验，如果所使用的“ 工具变量” 与扰动项相
关，则可能导致严重的偏差。

**1.恰好识别**

​	无法检验外生性，只能进行定性讨论或依赖于专家的意见。
​	定性讨论逻辑：如果工具变量是外生的，则其影响被解释变量的唯一渠道就是通过内生变量，除此以外别无其他渠道。由于此唯一渠道（内生变量）已被包括在回归方程中，故工具变拯不会再出现在被解释变盘的扰动项中，或对此扰动项有影响。此条件称为“ 排他性约束"。

**2.过度识别**

​	进行过度识别检验：在改模型至少是恰好识别的大前提下，原假设为“H_0所有工具变量都是外生的”

![image-20200727103744575](https://i.loli.net/2020/07/27/cwE9hOixQRXKbTv.png)



注：即使接受了过度识别的原假设，也并不能证明这些工具变量的外生性。

```stata
estat overid
```

## 10.7  对解释变量内生性的豪斯曼检验

工具变量法的前提：存在内生解释变量

若所有解释变量都是外生变量，则直接使用OLS。

豪斯曼检验的原假设为：H_0所有解释变量均为外生变量。

![image-20200727151106884](https://i.loli.net/2020/07/27/x5Gack3BMsrIqOt.png)

```stata
reg y x1 x2      	
estimates store ols			#存储OLS的结果，记为ols
ivregress 2sls y x1 (x2 = z1 z2)		#假设x2为内生变量，z1，z2为IV
estimates store iv			#存储2SLS的结果为iv
hausman iv ols ,constant sigmamore  #根据存储结果进行豪斯曼检验
```

传统豪斯曼检验的缺点：不适用于异方差的情形。

而改进的“杜宾-吴-豪斯曼检验”即使在异方差的情况下也适用。

```stata
#进行异方差稳健标准误
estat endogenous
```

## 10.8  如何获得工具变量

步骤：

(i) 列出与内生解释变量（x）相关的尽可能多的变量的清单（这一步较容易）；
(ii) 从这一清单中剔除与扰动项相关的变量（这一步较难）。

- 滞后变量。对于时间序列或面板数据，常使用内生解释变量的滞后作为工具变量。
- 警察人数与犯罪率。使用市长选举的政治周期作为工具变量。
- 制度对经济增长的影响。使用殖民者死亡率。
- 看电视过多对小儿自闭症的影响。使用降雨量作为工具变量。

## 10.9  工具变量法的Stata实例

```stata
qui reg lnw s expr tenure rns smsa,r
est sto ols_no_iq
qui reg lnw iq s expr tenure rns smsa,r
est sto ols_with_iq
qui ivregress 2sls lnw s expr tenure rns smsa (iq = med kww),r
est sto tsls
qui ivregress liml lnw s expr tenure rns smsa (iq = med kww),r
est sto liml
est table ols_no_iq ols_with_iq tsls liml.b se
#选择项 b 表示显示回归系数，而选择项 se 表示显示标准误
```

