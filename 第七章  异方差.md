# 第七章  异方差

## 7.1  异方差的后果

在存在异方差的情况下：

- OLS估计量依然是无偏的、一致且渐近正态；
- OLS估计量方差改变，因此使用普通标准误的t检验、F检验失效；
- 高斯-马尔可夫定理不再成立OLS不再是最佳线性无偏估计。

**大样本OLS理论是否已经假设了同方差？需要区分无条件方差与条件方差。**

## 7.2  异方差的例子

## 7.3  异方差的检验

1. 画残差图

   最直观的方法，但是不严格

2. BP检验

   使用LM统计量进行LM检验

   B和P最初检验假设扰动项服从正态分布，后来K将此减弱为独立同分布。

3. 怀特检验

   BP检验的假设条件方差函数为线性函数，忽略了高次项。

   ![XJNP$K8@U%@B509DLB{TF{C](D:\图片\截图\XJNP$K8@U%@B509DLB{TF{C.png)

   然后，对原假设H_0（x系数都为0）进行F检验或者LM检验。

   - 优点：可以检验任何形式的异方差
   - 缺点：如果解释变量较多，则解释变量的二次项将更多，在辅助回归中将损失较多的样本容量。

## 7.4  异方差的处理

1. 使用“OLS + 稳健标准误”

   

2. 加权最小二乘法（WLS）

   给予方差较小的观测值较大的权重，然后进行加权最小二乘法估计。

   基本思想：通过变量转换，使得变换后的模型满足球形扰动项的假定（变为同方差），然后进行OLS估计，即为最有效的BLUE（最佳线性无偏估计）。

   ![](D:\图片\截图\2L]]RI9]PQOCT_K_TSC~H7X.png)

3. 可行加权最小二乘法（FWLS）

   因为WLS必须确切的知道每个个体的方差，故WLS事实上不可行。解决方法是先用样本数据估计方差，然后再使用WLS，称这种方法为FWLS。

   ![](D:\图片\截图\QQ截图20200704104528.png)

   注：通过残差平方获得方差估计值。

4. 究竟使用“OLS + 稳健标准误”还是FWLS

   - FWLS更有效率，但是必须估计条件方差函数，且通常不知道条件方差函数的具体形式。
   - OLS+稳健标准误对回归系数及标准误的故居都是一致的，并不需要知道条件方差函数的形式，也更加稳健。
   - 在选择时需要考虑稳健性和有效性

## 7.5  处理异方差的Stata命令及实例

1. 画残差图

   ```stata
   reg y x_1 x_2  	#作回归
   rvfplot			#画残差和拟合值的散点图
   rvpplot x_1		#进一步，画残差和解释变量的散点图
   ```

2. BP检验

   ```stata
   estat hettest, iid rhs
   ```

   其中， "estat" 指post-estimation statistics (估计后统计量），即在完成估计后所计绊的后续统计量；"hettest" 表示heteroskeda-sticity test。选择项“ iid" 表示仅假定数据为iid，而无需正态假
   定。选择项"rhs"表示，使用方程右边的全部解释变量进行辅助回归，默认使用拟合值y进行辅助回归。

   如果指定某些变量进行辅助回归：

   ```stata
   estat hettest[varlist], iid
   ```

3. 怀特检验

   ```stata
   estat imtest, white
   ```

   p值等于0.000，故强烈拒绝同方差的原假设，认为存在异方差。

4. WLS

   通过以下命令来实现WLS：

   ```stata
   reg y1 x1 x2 x3 [aw = 1/var]	#var为计算后得到的方差矩阵
   ```

   具体例子见 p140（计量经济学及stata应用）

## 7.6  Stata命令的批处理

