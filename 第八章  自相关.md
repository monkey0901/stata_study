# 第八章  自相关

## 8.1  自相关的后果

1. OLS估计量依然是无偏、一致且渐近正态的；
2. OLS估计量方差改变，使用普通标准误的t检验、F检验失效
3. 高斯-马尔可夫定理不再成立，即OLS不再是BLUE

从信息角度来看，由于OLS估计忽略了扰动项自相关所包含的信息，故不是最有效的估计方法。

## 8.2  自相关的例子

1. 时间序列数据中的自相关
2. 横截面数据的自相关
3. 对数据的人为处理
4. 设定误差：模型设定出错

## 8.3  自相关的检验

**1.画图**

- 将残差和残差滞后画成散点图
- 由于k阶相关系数是滞后阶数k的函数，所以将其画图

**2.BG检验**

![image-20200707110146023](https://i.loli.net/2020/07/08/bv6dOQZF9XgUTHG.png)

![image-20200708165349839](https://i.loli.net/2020/07/08/gDn3MWTQEVvc8lj.png)

**注：**残差是解释变量的函数，故不能遗漏解释变量

- 通常使用nR^2形式的LM统计量进行检验

  ![image-20200708165632733](https://i.loli.net/2020/07/08/nP2VmkNgeulC7fD.png)

  **注：**辅助回归使其损失的p个样本值，如果LM统计量超过了卡方（p）的临界值，则拒绝无自相关的原假设。

- 之后有人建议将残差中因滞后而缺失 的项用其期望值0来代替。

**3.Q检验**

![image-20200708171116511](https://i.loli.net/2020/07/08/V6E9p2SYq1CaB7H.png)

这两个Q统计量在大样本下是等价的，下一种的小样本性质更好，为Stata所采用。

**4.DW检验**

**注：**现已不常用，因为其职能检验一阶自相关，且解释变量必须满足严格外生性的情况。

![image-20200709092957541](https://i.loli.net/2020/07/09/GSnmZiFOoKbwya5.png)

![image-20200709093055445](https://i.loli.net/2020/07/09/gVM9oPlAEbIJXa8.png)

## 8.4  自相关的处理

大致有四种处理方法：

**1.使用OLS+异方差自相关稳健的标准误（HAC）**

一般建议取
$$
p= n^{1/4}或p= 0. 75n^{1/3}
$$
称为“截断参数" ( truncation parameter) , 即比p更高阶的自相关系数将被截断而不考虑。由于HAC标准误取决于截断参数P,故在实践中，建议使用不同的截断参数，以考察HAC标准误是否对于截断参数敏感。

**2.准差分法**

![image-20200709104315389](https://i.loli.net/2020/07/09/2PLzDYRkr4hsKQt.png)

![image-20200709104338869](https://i.loli.net/2020/07/09/ns7FiA6f5dw92WK.png)

**注：**白噪声序列的特点表现在任何两个时点的随机变量都不相关，序列中没有任何可以利用的动态规律，因此不能用历史数据对未来进行预测和推断。

但这仍然不是最有效率的BLUE。

为得到BLUE估计量，补上损失的第一个方程。此时不会导致自相关，但会导致异方差。

![image-20200709104659025](https://i.loli.net/2020/07/09/IVOeF2q8a45ZCvT.png)

这种方法称为PW方法，某种意义上CO法和PW法都不可行，因为他们都假设知道一阶回归系数ρ。在实践中，必须用数据估计一阶自回归系数ρ。Stata默认的估计方法为使用OLS 残差进行辅助回归：
$$
e_t = ρe_{t-1} + error_t
$$
此外也可以使用残差的一阶自相关系数来估计。或通过DW统计量来估计。
$$
ρ=1-0.5DW
$$
**3.广义最小二乘法**

**注：**具体见p153

![image-20200709110518957](https://i.loli.net/2020/07/09/KEYAXW2jCrPTBFf.png)

从上式可知，虽然C 不唯一，但β_GLS唯一，因为β_GLS不依赖于C。由于高斯－ 马尔可夫定理成立，故β_GLS是BLUE,比OLS更有效率。使用GLS的前提是，必须知道协方差矩阵V。由于V通常未知，故在某种意义上，GLS是不可行的。在实践中，需通过数据估计v, 再进行GLS估计，称为“ 可行广义最小二乘法" (Feasible GLS, FGLS)。显然，WLS与PW都是GLS的特例，而FWLS与可行的PW法都是FGLS的特例。

总之，FGLS的适用条件比OLS更苛刻，不如OLS稳健。

**4.修改模型设定**

在有些情况下，自相关的深层原因可能是模型设定有误，比如，遗漏了自相关的解释变量；或将动态模型（解释变量中包含被解释变量的滞后值）误设为静态模型，而后者也可视为遗漏了解释变量。

总之，对于模型设定误差所导致的自相关，最好从改进模型设定着手解决，而不是机械地使用FGLS。

## 8.5  处理自相关的Stata命令及实例

**1.时间序列算子**

```stata
%假设时间变量
tsset year
```

常用的时间序列算子包括滞后(lag)与差分(difference), 分别以"L.“与"D ."来表示（可以小写）。

```stata
reg y L.x L2.x L3.x L4.x
%可简写为
reg y L(1/4).x
```

**2.画残差图**

**3.BG检验**

**4.Q检验**

**5.DW检验**

**6.HAC稳健标准误**

**7.处理一阶自相关的FGLS**

