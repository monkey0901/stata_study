# 第九章  模型设定与数据问题

## 9.1  遗漏变量

1. **遗漏变量与解释变量不相关**

   此时虽然存在遗漏变量，但OLS仍然可一致地估计回归系数，但可能影响OLS估计的精确度。

2. **遗漏变量与解释变量相关**

   此时根据大样本理论，OLS估计不一致

   解决遗漏变量偏差的方法主要有：

   - 加入尽可能多的控制变量：

     需从理论上说明，遗漏变量与解释变量相关，或相关性很弱

   - 随机试验和自然实验：

     ![image-20200717095012097](https://i.loli.net/2020/07/17/DUFnKS4O1J8xu9w.png)

   - 工具变量法：第十章

   - 使用面板数据：第十二章

## 9.2  无关变量

![image-20200717095756182](https://i.loli.net/2020/07/17/vjnh1Uo4cRLFgWf.png)

引入无关变量后，由于受到无关变量的干扰，估计量β的方差一般会增大，总之，对于解释变量的选择，最好遵循经济理论的指导。

## 9.3  建模策略

- 由小到大：先建立小模型，然后逐渐增加解释变量，小模型可能存在遗漏变量，导致系数估计不一致。
- 由大到小：从一个尽可能大的模型开始，收集所有可能的解释变量，再逐步剔除不显著的解释变量。

在实证研究中，常常采用两者的折中方案。

## 9.4  解释变量个数的选择

好的经济理论应该用简洁的模型来很好地描述复杂的经济现实。但这两个目标常常是矛盾的。在计量模型的设定上，加入过多的解释变量可以提高模型的解释力（比如增大拟合优度R^2 ), 但也牺牲了模型的简洁性(parsimony)。故需要在模型的解释力与简洁性之间找到最佳的
平衡。可供选择的权衡标准如下：

1. 校正可决系数R^2：选择解释变量的个数K以最大化R^2；

2. 赤池信息准则（AIC）：选择解释变量的个数K，使得以下目标函数最小化：

   ![image-20200717102458722](https://i.loli.net/2020/07/17/YvdU6qTXpuE9gsC.png)

3. 贝叶斯信息准则（BIC）也称为施瓦茨信息准则（SIC）：选择解释变量的个数K，使得以下目标函数最小化：

   ![image-20200717102755950](https://i.loli.net/2020/07/17/fhvpIn7GMsD5zJx.png)

   BIC 准则更强调模型的简洁性。而BIC 准则可能导致模型过小（对解释变量过多的惩罚太严厉），故AIC 准则依然很常用。

   在Stata中作完回归后，计算信息准则的命令为:

   ```stata
   estat ic
   ```

   

4. 由大到小的序贯 t 规则。这种方法常用于时间序列模型首先，设一个最大滞后期P_max , 令P = P_max进行估计，并对最后一阶系数的显著性进行t检验。如果接受该系数为0,则令p = P_max - 1，重新进行估计，再对（新的）最后一阶系数的显著性进行t检验，如果显著，则停止；否则，令P=P_max - 2; 以此类推。



stata 命令：

```stata
quietly regress consumption temp income price
estat ic
#加入temp的一阶滞后变量
quietly regress consumption temp L.temp income price
estat ic
```

## 9.5  对函数形式的检验

遗漏高次项也会导致遗漏变量偏差。"Ramsey' s RESET检验" (Regression EquationSpecification Error Test) (Ramsey, 1969)的基本思想是，如果怀疑非线性项被遗漏，那么就把非线性项引入方程，并检验其系数是否显著。

考虑以下辅助回归：

![image-20200717151725804](https://i.loli.net/2020/07/17/MWb9JDePC3EAvRs.png)

然后对
$$
H_0:δ_2=δ_3=δ_4=0
$$
作F检验。如果拒绝H_0，说明模型中应有高次项；反之，如果接受H_0，则可使用线性模型。RESET检验的缺点是，在拒绝H_0的情况下，并不提供具体遗漏哪些高次项的信息。

当然，也可以直接将解释变量x, 与X2 的高次项放入辅助回归中，比如
$$
y=α+βx_1+γx_2+δ_2x_1^2+δ_3x_2^2+δ_4x_1x_2+ε
$$
然后检验H_0 : :δ_2=δ_3=δ_4=0。关于如何确定回归方程的函数形式，最好从经济理论出发。在缺乏理论指导的情况下，可先从线性模型出发，然后进行RESET 检验，看是否应加入非线性项。

- stata 命令

  ```stata
  #首先，打开数据集进行线性OLS回归
  qui reg lnw s expr tenure smsa rns
  #使用拟合值的高次项进行RESET检验
  estat ovtest
  #然后使用解释变量的高次项进行RESET检验
  estat ovtest,rhs
  ```

## 9.6  多重共线性

无严格多重共线性是对数据的最低要求，在现实中较少违背。在实践中更为常见的是近似（非严格）的多重共线性，简称“ 多重共线性"(multi collinearity)或“ 共线性”。

在多重共线性的情况下，在所有线性无偏估计中方差最小，因为高斯－马尔可夫定理并未排除多重共线性的情形。

多重共线性的通常症状是，虽然整个回归方程的R^2 较大、F检验也很显著，但单个系数的t检验却不显著。另一症状是，增减解释变朵使得系数估计值发生较大变化（比如，最后加入的解释变址与已有解释变量构成多重共线性）。

![image-20200717185717037](https://i.loli.net/2020/07/17/BgMDo76vkdh9KJS.png)

方差膨胀因子：

![image-20200717185931682](https://i.loli.net/2020/07/17/JWsnUXmcPqGovCy.png)

## 9.7 极端数据

**1. 如何发现极端值**

- 对于一元回归，通过画图考察是否存在极端值

- 对于多元回归，某个观测值的影响力可通过去掉此观测值对回归系数的影响来衡量，比较全样本OLS估计值和去掉第i个观测值后的OLS估计值，通过他们差值的变化幅度来决定。

  ![image-20200722100405214](https://i.loli.net/2020/07/22/WXxLYkqOyUFIaKf.png)

![image-20200722100217016](https://i.loli.net/2020/07/22/R8a7f9gKBT6ydQN.png)

lev_i越大，观测数据的影响力越大。另外，可以证明，所有观测数据的影响力lev_i满足：
$$
(i)0≤lev_i≤1,(i=1,2……,n);
(ii)∑(1,n)lev_i=K(解释变量个数)
$$
因此，影响力lev_i的平均值为K/n。如果某些数据的lev_i 比平均值K/n 高很多，则可能对回归系数有很大影响。

```stata
predict lev,leverage
dis r(max)/r(mean)
```

- 如何处理：首先，应仔细检查是否因数据输入有误而导致极端观测值见其次，对出现极端观测值的个体进行背景调查，考察是否由与研究课题无关的特殊现象所致，必要时可以删除极端数据。最后，比较稳健的做法是同时汇报“ 全样本" (full sample)与删除极端数据后的“ 子样本"(subsample)的回归结果，让读者自己做判断。

## 9.8  虚拟变量

如果使用“ 定性数据"(qualitative data)或“ 分类数据"(categorical data) , 通常需要引入“虚拟变量” ，即取值为0或1的变量。

在有常数项的模型中，如果定性指标共分M类，则最多只能在回归方程中放入(M-1)个虚拟变量。否则会产生严格多重共线性，而造成虚拟变量陷阱。如果模型中没有常数项，则可以放入M个虚拟变量。

引入虚拟变量的影响：

- 仅仅引入虚拟变量本身，改变截距项
- 引入虚拟变量及虚拟变量与解释变量的互动项

```stata
#()表示进行逻辑判断，若表达式为真，取1，反之取0
gen d=(year >= 1978)
#为每个省设立一个虚拟变量, tabulate表示将变量按其取值列表
tabulate proxince ,generate(prov)
```

## 9.9  经济结构变动的检验

**1.邹检验**

- 步骤

  - 回归整个样本，得到残差平方和SSR^*

  - 回归第一部分样本，得到残差平方和SSR_1

  - 回归第二部分样本，得到残差平方和SSR_2
  - 再比较(SSR* - SSR_1 - SSR_2)的大小
  - 使用F统计量：![image-20200723095936368](https://i.loli.net/2020/07/23/thqRJNn9jGba6wK.png)

**2.虚拟变量法**

![image-20200723100038665](https://i.loli.net/2020/07/23/vnfI7xDmAea1S6d.png)

- 虚拟变量的优点：
  - 只需生成虚拟变量即可检验，十分方便；
  -  邹检验是在“ 球形扰动项“(同方差、无自相关）的假设下得到
    的，并不适用于异方差或自相关的情形。在异方差或自相关的情况下，仍可使用虚拟变量法，只要在估计方程(9.43) 时，使用异方差自相关稳健的HAC标准误即可。
  - 如果发现存在结构变动，邹检验并不提供究竟是截距项还是斜率变动的信息（至少需要再作一个邹检验），而虚拟变量法则可同时提供这些信息。

## 9.10  缺失数据与线性插值

数据中存在缺失，解决方法：

- 取临近两值的平均值
- 假设变量线性均匀变化，该点在临近两值的连线上
- 对于有指数增长趋势的，应先取对数，再进行线性插值

```stata
ipolate y x,gen(newvar)
```



